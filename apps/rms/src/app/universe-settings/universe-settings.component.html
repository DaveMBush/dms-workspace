<p-dialog 
  header="Universe Settings" 
  [(visible)]="settingsService.visible$" 
  [modal]="true" 
  [style]="{ width: '25vw' }" 
  (onShow)="onDialogShow()"
  [attr.aria-labelledby]="'universe-dialog-header'"
  [attr.aria-describedby]="'universe-dialog-description'"
  role="dialog">
  
  <div id="universe-dialog-description" class="sr-only">
    Dialog for updating universe stock symbols via screener service
  </div>
    
  <h4 id="universe-dialog-header" class="mt-0">Current Universe</h4>

  <!-- Error message display -->
  @if (hasError$()) {
    <div role="alert" aria-live="assertive" class="error-container">
      <p-message severity="error" [text]="errorText$()"></p-message>
    </div>
  }

  <ng-template pTemplate="footer">
    <p-button 
      (click)="settingsService.hide()" 
      label="Cancel" 
      severity="secondary"
      [attr.aria-label]="'Cancel and close dialog'">
    </p-button>
    <p-button 
      label="Update Fields" 
      (click)="updateFields()"
      [loading]="loading && !isSyncing$()"
      [disabled]="loading"
      [attr.aria-label]="'Update metadata and field information'">
    </p-button>
    <!-- Update Universe button - uses screener service -->
    <p-button 
      (click)="useScreener$()" 
      label="Update Universe" 
      [loading]="isSyncing$()" 
      [disabled]="isSyncing$()" 
      [attr.aria-label]="updateButtonAriaLabel$()"
      [attr.aria-describedby]="'screener-update-help'"
      class="update-universe-btn">
    </p-button>
    <div id="screener-update-help" class="sr-only">
      Updates universe data automatically from screener service
    </div>
  </ng-template>
  @if (loading) {
    <div class="modal-spinner-overlay" 
         role="status" 
         aria-live="polite" 
         [attr.aria-label]="loadingAriaLabel$()">
      <p-progressSpinner 
        styleClass="modal-spinner" 
        strokeWidth="4" 
        animationDuration=".7s"
        [attr.aria-label]="'Loading indicator'"/>
      <span class="sr-only">{{loadingAriaLabel$()}}</span>
    </div>
  }
</p-dialog>

<!-- Toast for notifications -->
<p-toast></p-toast>
