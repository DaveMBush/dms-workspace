<!-- eslint-disable @angular-eslint/template/no-call-expression -->
<!-- Login Container -->
<div
  class="min-h-screen min-w-full flex items-center justify-center p-4 bg-surface-ground"
>
  <div class="w-full max-w-xl mx-4">
    <!-- Login Card -->
    <div class="surface-card border-round shadow-3 p-6">
      <!-- Header -->
      <div class="text-center mb-6">
        <h1 class="text-3xl font-bold text-primary mb-2">RMS Login</h1>
        <span class="text-color-secondary font-medium"
          >Sign in to your account</span
        >
      </div>

      <!-- Login Form -->
      <form
        [formGroup]="loginForm"
        (ngSubmit)="onSubmit()"
        class="flex flex-column gap-4"
      >
        <!-- Email Field -->
        <div class="field">
          <label for="email" class="block text-color font-medium mb-2">
            Email Address <span class="text-red-500">*</span>
          </label>
          <input
            pInputText
            id="email"
            type="email"
            formControlName="email"
            placeholder="Enter your email address"
            class="w-full"
            [class.ng-invalid]="emailInvalid()"
            [class.ng-dirty]="emailControl?.dirty"
            autocomplete="email"
            aria-describedby="email-error"
          />
          @if (emailInvalid()) {
          <small id="email-error" class="text-red-500 mt-1 block">
            {{ getEmailErrorMessage() }}
          </small>
          }

          <!-- Form Help Text -->
          <div class="mt-3">
            <small class="text-color-secondary">
              Need help? Contact your system administrator.
            </small>
          </div>
        </div>

        <!-- Password Field -->
        <div class="field">
          <label for="password" class="block text-color font-medium mb-2">
            Password <span class="text-red-500">*</span>
          </label>
          <p-password
            inputId="password"
            formControlName="password"
            placeholder="Enter your password"
            [toggleMask]="true"
            [feedback]="false"
            styleClass="w-full"
            [class.ng-invalid]="passwordInvalid()"
            [class.ng-dirty]="passwordControl?.dirty"
            autocomplete="current-password"
            [promptLabel]="''"
            [weakLabel]="''"
            [mediumLabel]="''"
            [strongLabel]="''"
          >
          </p-password>
          @if (passwordInvalid()) {
          <small id="password-error" class="text-red-500 mt-1 block">
            {{ getPasswordErrorMessage() }}
          </small>
          }

          <!-- Submit Button -->
          <div class="mt-4 flex justify-end">
            <p-button
              type="submit"
              label="Sign In"
              icon="pi pi-sign-in"
              [disabled]="isFormInvalid()"
              [loading]="isLoading$()"
              loadingIcon="pi pi-spin pi-spinner"
            >
            </p-button>
          </div>
        </div>

        <!-- Authentication Error Message -->
        @if (authError$()) {
        <div class="mb-3">
          <p-message
            severity="error"
            [text]="authError$()!"
            class="w-full"
            [closable]="false"
          >
          </p-message>
        </div>
        }
      </form>
    </div>

    <!-- Loading Overlay -->
    @if (isLoading$()) {
    <div
      class="absolute inset-0 bg-black bg-opacity-20 flex items-center justify-center z-50 border-round"
    >
      <div class="surface-card p-4 border-round shadow-3">
        <p-progressSpinner
          strokeWidth="3"
          animationDuration="2s"
        ></p-progressSpinner>
        <div class="text-center mt-2 text-sm text-color-secondary">
          Signing you in...
        </div>
      </div>
    </div>
    }
  </div>
</div>
