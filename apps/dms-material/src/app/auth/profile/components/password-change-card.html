<!-- eslint-disable @angular-eslint/template/no-call-expression -->
<mat-card>
  <mat-card-header>
    <mat-card-title>Change Password</mat-card-title>
  </mat-card-header>

  <mat-card-content>
    <form [formGroup]="passwordForm" (ngSubmit)="onSubmit()">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Current Password</mat-label>
        <input
          matInput
          [type]="hideCurrentPassword() ? 'password' : 'text'"
          formControlName="currentPassword"
          autocomplete="current-password"
        />
        <button
          mat-icon-button
          matSuffix
          type="button"
          (click)="hideCurrentPassword.set(!hideCurrentPassword())"
        >
          <mat-icon
            >{{ hideCurrentPassword() ? 'visibility_off' : 'visibility'
            }}</mat-icon
          >
        </button>
        @if (passwordForm.get('currentPassword')?.hasError('required')) {
        <mat-error>Current password is required</mat-error>
        }
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>New Password</mat-label>
        <input
          matInput
          [type]="hideNewPassword() ? 'password' : 'text'"
          formControlName="newPassword"
          autocomplete="new-password"
        />
        <button
          mat-icon-button
          matSuffix
          type="button"
          (click)="hideNewPassword.set(!hideNewPassword())"
        >
          <mat-icon
            >{{ hideNewPassword() ? 'visibility_off' : 'visibility' }}</mat-icon
          >
        </button>
        @if (passwordForm.get('newPassword')?.hasError('required')) {
        <mat-error>New password is required</mat-error>
        } @if (passwordForm.get('newPassword')?.hasError('minlength')) {
        <mat-error>Password must be at least 8 characters</mat-error>
        }
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Confirm New Password</mat-label>
        <input
          matInput
          [type]="hideConfirmPassword() ? 'password' : 'text'"
          formControlName="confirmPassword"
          autocomplete="new-password"
        />
        <button
          mat-icon-button
          matSuffix
          type="button"
          (click)="hideConfirmPassword.set(!hideConfirmPassword())"
        >
          <mat-icon
            >{{ hideConfirmPassword() ? 'visibility_off' : 'visibility'
            }}</mat-icon
          >
        </button>
        @if (passwordForm.get('confirmPassword')?.hasError('required')) {
        <mat-error>Please confirm your new password</mat-error>
        }
      </mat-form-field>

      <button
        mat-raised-button
        color="primary"
        type="submit"
        [disabled]="isLoading()"
      >
        @if (isLoading()) {
        <mat-spinner diameter="20"></mat-spinner>
        } @else { Change Password }
      </button>
    </form>
  </mat-card-content>
</mat-card>
