<!-- eslint-disable @angular-eslint/template/no-call-expression -->
<div class="login-container">
  <mat-card class="login-card">
    <mat-card-header>
      <mat-card-title>Welcome to RMS</mat-card-title>
      <mat-card-subtitle>Sign in to continue</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="loginForm" (ngSubmit)="onSubmit()">
        @if (errorMessage(); as error) {
        <div class="error-banner">
          <mat-icon>error</mat-icon>
          <span>{{ error }}</span>
        </div>
        }

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Email</mat-label>
          <mat-icon matIconPrefix>email</mat-icon>
          <input
            matInput
            type="email"
            placeholder="Enter Email"
            formControlName="email"
            autocomplete="email"
            (blur)="updateValidationErrors()"
          />
          @if (emailHasRequiredError()) {
          <mat-error>Email is required</mat-error>
          } @else if (emailHasFormatError()) {
          <mat-error>Please enter a valid email</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Password</mat-label>
          <mat-icon matIconPrefix>lock</mat-icon>
          <input
            matInput
            [type]="passwordFieldType()"
            placeholder="Enter Password"
            formControlName="password"
            autocomplete="current-password"
            (blur)="updateValidationErrors()"
          />
          <button
            mat-icon-button
            matIconSuffix
            type="button"
            (click)="togglePasswordVisibility()"
            [attr.aria-label]="passwordToggleAriaLabel()"
          >
            <mat-icon>{{ passwordToggleIcon() }}</mat-icon>
          </button>
          @if (passwordHasRequiredError()) {
          <mat-error>Password is required</mat-error>
          } @else if (passwordHasMinLengthError()) {
          <mat-error>Password must be at least 8 characters</mat-error>
          }
        </mat-form-field>

        <mat-checkbox formControlName="rememberMe" color="primary">
          Remember me for 90 days
        </mat-checkbox>

        @if (isLoading()) {
        <button
          mat-raised-button
          color="primary"
          type="submit"
          class="full-width submit-button"
          disabled
        >
          <mat-spinner diameter="20"></mat-spinner>
        </button>
        } @else {
        <button
          mat-raised-button
          color="primary"
          type="submit"
          class="full-width submit-button"
        >
          Sign In
        </button>
        }
      </form>
    </mat-card-content>
  </mat-card>
</div>
